<div class="problem-statement">
   <div class="header">
      <h1 class="title">J. Форматирование документа</h1>
      <table>
         <tr class="time-limit">
            <td class="property-title">Ограничение времени</td>
            <td>2&nbsp;секунды</td>
         </tr>
         <tr class="memory-limit">
            <td class="property-title">Ограничение памяти</td>
            <td>64Mb</td>
         </tr>
         <tr class="input-file">
            <td class="property-title">Ввод</td>
            <td colspan="1">стандартный ввод или input.txt</td>
         </tr>
         <tr class="output-file">
            <td class="property-title">Вывод</td>
            <td colspan="1">стандартный вывод или output.txt</td>
         </tr>
      </table>
   </div>
   <h2></h2>
   <div class="legend"><span style="">
         <p>Вася пишет новую версию своего офисного пакета "Closed Office". Недавно он начал работу над редактором "Dword", входящим в
            состав пакета. 
         </p></span><p>Последняя проблема, с которой столкнулся Вася &mdash; размещение рисунков в документе. Он никак не может добиться стабильного отображения рисунков в тех местах, в которые он их
         помещает. Окончательно отчаявшись написать соответствующий модуль самостоятельно, Вася решил обратиться за помощью к вам.
         Напишите программу, которая будет осуществлять размещение документа на странице.
      </p>
      <p>Документ в формате редактора "Dword" представляет собой последовательность абзацев. Каждый абзац представляет собой последовательность
         элементов – слов и рисунков. Элементы одного абзаца разделены пробелами и/или переводом строки. Абзацы разделены пустой строкой.
         Строка, состоящая только из пробелов, считается пустой.
      </p>
      <p>Слово&nbsp;&mdash; это последовательность символов, состоящая из букв латинского алфавита, цифр, и знаков препинания: ".", ",", ":", ";", "!",
         "?", "-", "'".
      </p>
      <p>Рисунок описывается следующим образом: "(<span style="font-weight:bold;">image</span> image parameters)". Каждый параметр рисунка имеет вид "имя=значение". Параметры рисунка разделены пробелами и/или переводом
         строки. У каждого рисунка обязательно есть следующие параметры:
      </p>
      <p>width&nbsp;&mdash; целое положительное число, ширина рисунка в пикселях height&nbsp;&mdash; целое положительное число, высота рисунка в пикселях layout&nbsp;&mdash; одно из следующих значений: embedded (в тексте), surrounded (обтекание текстом), floating (свободное), описывает расположение
         рисунка относительно текста
      </p>
      <p>Документ размещается на бесконечной вверх и вниз странице шириной <span class="tex-math-text">w</span> пикселей (разбиение на конечные по высоте страницы планируется в следующей версии редактора). Одна из точек на левой границе
         страницы условно считается точкой с ординатой равной нулю. Ордината увеличивается вниз.
      </p>
      <p>Размещение документа происходит следующим образом. Абзацы размещаются по очереди. Первый абзац размещается так, что его верхняя
         граница имеет ординату 0.
      </p>
      <p><img class="user-image" src="https://contest.yandex.ru/testsys/statement-image?imageId=b6b741a0d823f61242a2389761b2fd673b464953954e7e227db1ab2135c2642f"></p>
      <p>Абзац размещается следующим образом. Элементы располагаются по строкам. Каждая строка исходно имеет высоту <span class="tex-math-text">h</span> пикселей. В процессе размещения рисунков высота строк может увеличиваться, и строки могут разбиваться рисунками на фрагменты.
      </p>
      <p><img class="user-image" src="https://contest.yandex.ru/testsys/statement-image?imageId=5393ea5a76f6bdaf30cacf3e3ac660e2367a0d908f7a61b88cee7cc1443b4657"></p>
      <p>Слова размещаются следующим образом. Считается, что каждый символ имеет ширину c пикселей. Перед каждым словом, кроме первого
         во фрагменте, ставится пробел шириной также в <span class="tex-math-text">c</span> пикселей. Если слово помещается в текущем фрагменте, то оно размещается на нем. Если слово не помещается в текущем фрагменте,
         то оно размещается в первом фрагменте текущей строки, расположенном правее текущего, в котором оно помещается. Если такого
         фрагмента нет, то начинается новая строка, и поиск подходящего фрагмента продолжается в ней. Слово всегда "прижимается" к
         верхней границе строки.
      </p>
      <p>Размещение рисунка зависит от его расположения относительно текста.</p>
      <p>Если расположение рисунка относительно текста установлено в "embedded", то он располагается так же, как слово, за тем исключением,
         что его ширина равна ширине, указанной в параметрах рисунка. Кроме того, если высота рисунка больше текущей высоты строки,
         то она увеличивается до высоты рисунка (при этом верхняя граница строки не перемещается, а смещается вниз нижняя граница).
         Если рисунок типа "embedded" не первый элемент во фрагменте, то перед ним ставится пробел шириной <span class="tex-math-text">c</span> пикселей. Рисунки типа "embedded" также прижимаются к верхней границе строки.
      </p>
      <p>Если расположение рисунка относительно текста установлено в "surrounded", то рисунок размещается следующим образом. Сначала
         аналогично находится первый фрагмент, в котором рисунок помещается по ширине. При этом перед рисунком этого типа не ставится
         пробел, даже если это не первый элемент во фрагменте.
      </p>
      <p>После этого рисунок размещается следующим образом: верхний край рисунка совпадает с верхней границей строки, в которой находится
         найденный фрагмент, а сам рисунок продолжается вниз. При этом строки, через которые он проходит, разбиваются им на фрагменты.
      </p>
      <p>Если расположение рисунка относительно текста установлено в "floating", то рисунок размещается поверх текста и других рисунков
         и никак с ними не взаимодействует. В этом случае у рисунка есть два дополнительных параметра: "dx" и "dy"&nbsp;&mdash; целые числа, задающие смещение в пикселях верхнего левого угла рисунка вправо и вниз, соответственно, относительно позиции,
         где находится верхний правый угол предыдущего слова или рисунка (или самой левой верхней точки первой строки абзаца, если
         рисунок&nbsp;&mdash; первый элемент абзаца).
      </p>
      <p>Если при размещении рисунка таким образом он выходит за левую границу страницы, то он смещается вправо, так, чтобы его левый
         край совпадал с левой границей страницы. Аналогично, если рисунок выходит за правую границу страницы, то он смещается влево,
         чтобы его правый край совпадал с правой границей страницы.
      </p>
      <p>Верхняя граница следующего абзаца совпадает с более низкой точкой из нижней границы последней строки и самой нижней границы
         рисунков типа "surrounded" предыдущего абзаца.
      </p>
      <p>По заданным <span class="tex-math-text">w</span>, <span class="tex-math-text">h</span>, <span class="tex-math-text">c</span> и документу найдите координаты верхних левых углов всех рисунков в документе. 
      </p>
   </div>
   <h2>Формат ввода</h2>
   <div class="input-specification"><span style="">
         <p>Первая строка входного файла содержит три целых числа: <span class="tex-math-text">w</span>, <span class="tex-math-text">h</span> и <span class="tex-math-text">c</span> (<span class="tex-math-text">1 &le; w &le; 1000</span>, <span class="tex-math-text">1 &le; h &le; 50</span>, <span class="tex-math-text">1 &le; c &le; w</span>). 
         </p></span><p>Далее следует документ. Размер входного файла не превышает 1000 байт. Гарантируется, что ширина любого слова и любого рисунка
         не превышает <span class="tex-math-text">w</span>. Высота всех рисунков не превышает <span class="tex-math-text">1000</span>. Относительное смещение всех рисунков типа &laquo;<span class="tex-monospace">floating</span>&raquo; не превышает <span class="tex-math-text">1000</span> по абсолютной величине. 
      </p>
   </div>
   <h2>Формат вывода</h2>
   <div class="output-specification"><span style="">
         <p>Выведите в выходной файл по два числа для каждого рисунка &mdash; координаты его верхнего левого угла. Выводите координаты рисунков в том порядке, в котором они встречаются во входном файле.</p></span></div>
   <h3>Пример 1</h3>
   <table class="sample-tests">
      <thead>
         <tr>
            <th>Ввод</th>
            <th>Вывод</th>
         </tr>
      </thead>
      <tbody>
         <tr>
            <td><pre>120 10 8
start (image layout=embedded width=12 height=5)
(image layout=surrounded width=25 height=58)
and word is 
(image layout=floating dx=18 dy=-15 width=25 height=20)
here new 
(image layout=embedded width=20 height=22)
another
(image layout=embedded width=40 height=19)
longword

new paragraph
(image layout=surrounded width=5 height=30)
(image layout=floating width=20 height=35 dx=50 dy=-16)
</pre></td>
            <td><pre>48 0
60 0
74 -5
32 20
0 52
104 81
100 65
</pre></td>
         </tr>
      </tbody>
   </table>
   <h3>Пример 2</h3>
   <table class="sample-tests">
      <thead>
         <tr>
            <th>Ввод</th>
            <th>Вывод</th>
         </tr>
      </thead>
      <tbody>
         <tr>
            <td><pre>1000 2 3
</pre></td>
            <td><pre></pre></td>
         </tr>
      </tbody>
   </table>
   <h3>Пример 3</h3>
   <table class="sample-tests">
      <thead>
         <tr>
            <th>Ввод</th>
            <th>Вывод</th>
         </tr>
      </thead>
      <tbody>
         <tr>
            <td><pre>100 2 3
(image dx=10 dy=11 height=100 width=20 layout=floating)
</pre></td>
            <td><pre>10 11
</pre></td>
         </tr>
      </tbody>
   </table>
</div>
